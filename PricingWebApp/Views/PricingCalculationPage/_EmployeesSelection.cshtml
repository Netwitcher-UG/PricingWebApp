@using static PricingWebApp.Controllers.PricingCalculationPageController
@model MyPagesModels

<div class="card" style="width:49%">
    <div class="card-header">
        <h3 class="card-title">Employees Selection</h3>
    </div>
    <!-- /.card-header -->
    <div class="card-body">
        <table class="table table-bordered">

            <thead>
                <tr>
                    <th style="width: 10%">#</th>
                    <th style="width:25%">Name</th>
                    <th style="width: 20%">Hour Rate</th>
                    <th style="width: 20%">Hour Count</th>
                    <th style="width: 25%">Sum</th>
                </tr>
            </thead>
            <tbody id="pricingEmployees">

                @for (int i = 0; i < Model.EmployeesModel?.Count(); i++)
                {
                    <tr>
                        <td>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" asp-for="MyEmployeesRows[i].IsChecked" id="myEmployeeCheckbox_@Model.EmployeesModel[i].Id">
                            </div>
                        </td>
                        <td>
                            <label for="myEmployeeCheckbox_@Model.EmployeesModel[i].Id" style="user-select :none"> @Model.EmployeesModel[i].FirstName @Model.EmployeesModel[i].LastName </label>
                        </td>
                        <td>
                            <label for="myEmployeeCheckbox_@Model.EmployeesModel[i].Id" style="user-select :none;"> @Model.EmployeesModel[i].HourRate </label>
                            <span id="myEmployeeHourRate_@Model.EmployeesModel[i].Id" style="display:none;">@Model.EmployeesModel[i].HourRate</span>
                        </td>
                        <td>
                            <input type="number" asp-for="MyEmployeesRows[i].EmployeeCount" class="form-control form-control-sm" id="myEmployeeInput_@Model.EmployeesModel[i].Id" min="1">
                        </td>
                        <td>
                            <input type="hidden" asp-for="MyEmployeesRows[i].Id" style="display:none" value="@Model.EmployeesModel[i].Id">
                            <span id="resultEmployee_@Model.EmployeesModel[i].Id"></span>
                        </td>

                    </tr>
                }
            </tbody>
        </table>
    </div>

</div>

<script>


    window.addEventListener('load', lockMyField);
    document.getElementById("pricingEmployees").addEventListener("change", lockMyField);
    function lockMyField() {
        const checkboxes = document.querySelectorAll("#pricingEmployees input[type='checkbox']");

        checkboxes.forEach(function (checkbox) {
            const numberInputs = checkbox.closest("tr").querySelectorAll("input[type='number']");

            if (checkbox.checked) {
                numberInputs.forEach(function (input) {
                    input.disabled = false;
                });
            } else {
                numberInputs.forEach(function (input) {
                    input.disabled = true;
                    input.value = "";

                    const spanId = "resultEmployee_" + input.closest("tr").querySelector("input[type='hidden']").value;
                    const spanElement = document.getElementById(spanId);
                    spanElement.textContent = "";
                });
            }
        });
    }

    const myFeilds = document.querySelectorAll('#pricingEmployees tr td input[type="number"]');

    myFeilds.forEach(input => {
        input.addEventListener("input", function () {
            const rowId = this.closest("tr").querySelector("input[type='hidden']").value;
            const spanId = "resultEmployee_" + rowId;
            const myFeild1Id = "myEmployeeInput_" + rowId;
            const myFeild1 = document.getElementById(myFeild1Id);
            const employeeHourRate = document.getElementById("myEmployeeHourRate_" + rowId).textContent;
            if (myFeild1.value.length > 6) { myFeild1.value = 999999; }
            myFeild1.addEventListener("focus", function () { this.select(); });
            const spanElement = document.getElementById(spanId);
            spanElement.textContent = EuroEmployeeSignal(employeeHourRate * myFeild1.value);
        });
    });

    function EuroEmployeeSignal(elm) {
        const x = new Intl.NumberFormat('de-DE', {
            style: 'currency',
            currency: 'EUR',
        }).formatToParts(elm).map(
            p => p.type != 'literal' && p.type != 'currency' ? p.value : ''
        ).join('');
        var y = x + "€"
        return y;

    }


</script>